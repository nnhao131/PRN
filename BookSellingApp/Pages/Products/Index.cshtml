@page 
@model BookSellingApp.Pages.Products.IndexModel
@{
    Layout = "_Layout";
}
<!-- Shop Page Start -->
<div class="main-shop-page pt-100 pb-100 ptb-sm-60">
    <div class="container">
        <!-- Row End -->
        <div class="row">
            <!-- Sidebar Shopping Option Start -->
            <div class="col-lg-3 order-2 order-lg-1">
                <div class="sidebar">
                    <!-- Sidebar Electronics Categorie Start -->
                    <div class="electronics mb-40">
                        <h3 class="sidebar-title">Categories</h3>
                        <div id="shop-cate-toggle" class=" ">
                            @foreach (var item in Model.cate)
                            {
                                <ul style="background-color: #F91616; front-size: 5px;">
                                    <li>
                                        <a data-category="@item.CategoryName" class="category-link"
                                           style="font-size:18px;">@item.CategoryName</a>
                                    </li>
                                    
                                </ul>

                                <br />
                            }
                        </div>
                        
                        <!-- category-menu-end -->
                    </div>
                    <!-- Sidebar Electronics Categorie End -->
                   
                    <!-- Product Top Start -->
                    <div class="top-new mb-40">
                        <h3 class="sidebar-title">Top New</h3>
                        <div class="side-product-active owl-carousel">
                            <!-- Side Item Start -->
                            <div class="side-pro-item">
                                <!-- Single Product Start -->
                                @foreach(var item in Model.productNum)
                                {
                                    <div class="single-product single-product-sidebar">
                                        <!-- Product Image Start -->
                                        <div class="pro-img">

                                            <a asp-page="ProductDetail" asp-route-id="@item.Id">
                                                @if (item.Image != null && @item.Image.Length > 0)
                                                {
                                                    <img class="primary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                    <img class="secondary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                }
                                                else
                                                {
                                                    <img class="primary-img" src="img\products\20.jpg" alt="single-product">
                                                    <img class="secondary-img" src="img\products\19.jpg" alt="single-product">
                                                }
                                                
                                            </a>
                                            
                                        </div>
                                        <!-- Product Image End -->
                                        <!-- Product Content Start -->
                                        <div class="pro-content">
                                            <h4><a href="">@item.ProductName</a></h4>
                                            <p><span class="price">$@item.Price</span></p>
                                        </div>
                                        <!-- Product Content End -->
                                    </div>
                                }
                                
                                <!-- Single Product End -->
                               
                            </div>
                            <!-- Side Item End -->
                        </div>
                    </div>
                    <!-- Product Top End -->
                   
                </div>
            </div>
            <!-- Sidebar Shopping Option End -->
            <!-- Product Categorie List Start -->
            <div class="col-lg-9 order-1 order-lg-2">
                <!-- Grid & List View Start -->
                <div class="grid-list-top border-default universal-padding d-md-flex justify-content-md-between align-items-center mb-30">
                    <div class="grid-list-view  mb-sm-15">
                        <ul class="nav tabs-area d-flex align-items-center">
                            <li><a class="active" data-toggle="tab" href="#grid-view"><i class="fa fa-th"></i></a></li>
                            <li><a data-toggle="tab" href="#list-view"><i class="fa fa-list-ul"></i></a></li>
                        </ul>
                    </div>
                    <!-- Toolbar Short Area Start -->
                    <form method="get">
                    <div class="main-toolbar-sorter clearfix">
                        <div class="toolbar-sorter d-flex align-items-center">
                                <label><button style="border-radius:5px;background:#ffffff" type="submit">Sort</button></label>
                                <select class="sorter wide" asp-for="SortOrder">
                                <option value="Position" selected="">Relevance</option>
                                <option value="PriceLowToHigh">Price low to heigh</option>
                                <option value="PriceHighToLow" >Price heigh to low</option>
                            </select>
                        </div>
                            
                    </div>
                    </form>
                    
                </div>
                <!-- Grid & List View End -->
                <div class="main-categorie mb-all-40">
                    <!-- Grid & List Main Area End -->
                    <div class="tab-content fix">
                        <div id="grid-view" class="tab-pane fade show active">
                            <div class="row">
                                <!-- Single Product Start -->
                                
                                @foreach(var item in Model.products.Items){
                                <div class="col-lg-4 col-md-4 col-sm-6 col-6">
                                    <div class="single-product">
                                        <!-- Product Image Start -->
                                        <div class="pro-img">
                                                <a asp-page="ProductDetail" asp-route-id="@item.Id">

                                                    @if (item.Image != null && @item.Image.Length > 0)
                                                    {
                                                        <img class="primary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                        <img class="secondary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                    }
                                                    else
                                                    {
                                                        <img class="primary-img" src="" alt="single-product">
                                                        <img class="secondary-img" src="" alt="single-product">
                                                    }
                                            </a>
                                            
                                        </div>
                                        <!-- Product Image End -->
                                        <!-- Product Content Start -->
                                        <div class="pro-content">
                                            <div class="pro-info">
                                                    <h4><a >@item.ProductName</a></h4>
                                                <p><span class="price">$@item.Price</span></p>
                                               
                                            </div>
                                            <div class="pro-actions">
                                                    @Html.AntiForgeryToken()
                                                <div class="actions-primary">

                                                        <a class="add-to-cart" data-product-id="@item.Id" title="Add to Cart"> + Add To Cart</a>
                                                </div>
                                               
                                            </div>
                                        </div>
                                        <!-- Product Content End -->
                                    </div>
                                </div>
                                }
                             
                                <!-- Single Product End -->
                                
                               
                               
                            </div>
                            <!-- Row End -->
                        </div>
                        <!-- #grid view End -->
                        <div id="list-view" class="tab-pane fade">
                            <!-- Single Product Start -->
                            @foreach(var item in Model.products.Items){
                            <div class="single-product">
                                <div class="row">
                                    <!-- Product Image Start -->
                                    <div class="col-lg-4 col-md-5 col-sm-12">
                                        <div class="pro-img">
                                                <a asp-page="ProductDetail" asp-route-id="@item.Id">
                                                    @if (item.Image != null && @item.Image.Length > 0)
                                                    {
                                                        <img class="primary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                        <img class="secondary-img" src="data:image/png;base64,@Convert.ToBase64String(item.Image)" alt="single-product">
                                                    }
                                                    else
                                                    {
                                                        <img class="primary-img" src="" alt="single-product">
                                                        <img class="secondary-img" src="" alt="single-product">
                                                    }

                                                </a>
                                           
                                            <span class="sticker-new">new</span>
                                        </div>
                                    </div>
                                    <!-- Product Image End -->
                                    <!-- Product Content Start -->
                                    <div class="col-lg-8 col-md-7 col-sm-12">
                                        <div class="pro-content hot-product2">
                                            <h4><a href="product.html">@item.ProductName</a></h4>
                                            <p><span class="price">$@item.Price</span></p>
                                            <p>@item.Description</p>
                                            <div class="pro-actions">
                                                    @Html.AntiForgeryToken()
                                                <div class="actions-primary">
                                                        <a class="add-to-cart" data-product-id="@item.Id" title="" data-original-title="Add to Cart"> + Add To Cart</a>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Product Content End -->
                                </div>
                            </div>
                            }
                            <!-- Single Product End -->
                           

                        </div>
                        <!-- #list view End -->
                        <div class="pro-pagination">
                            <ul class="blog-pagination">
                                @if (Model.products.PageNumber >1 )
                                {
                                    <li>
                                        <a href="/Products?PageNumber=@(Model.products.PageNumber -1)&PageSize=@Model.pageSize">
                                            <i class="fa fa-angle-left"></i>
                                        </a>
                                    </li>
                                }
                                @for (var i = 1; i <= Model.products.TotalPages; i++)
                                {
                                    
                                    <li class="@(i == Model.products.PageNumber ? "active" : "")">
                                        @if (Model.products.TotalCount > 9)
                                        {
                                            <a asp-page-handler="OnGet" asp-route-PageNumber="@i">@i</a>
                                        }
                                       
                                    </li>
                                }
                                
                                @if (Model.products.PageNumber < Model.products.TotalPages)
                                {
                                    <li>
                                        <a href="/Products?PageNumber=@(Model.products.PageNumber + 1)&PageSize=@Model.pageSize">
                                            <i class="fa fa-angle-right"></i>
                                        </a>
                                    </li>
                                }
                            </ul>
                            <div class="product-pagination">
                                <span class="grid-item-list">Showing @Model.products.PageNumber to @Model.products.PageSize of @Model.products.TotalCount (@Model.products.TotalPages Page) </span>
                            </div>
                        </div>
                        <!-- Product Pagination Info -->
                    </div>
                    <!-- Grid & List Main Area End -->
                </div>
            </div>
            <!-- product Categorie List End -->
        </div>
        <!-- Row End -->
    </div>
    <!-- Container End -->
</div>
<!-- Shop Page End -->

}

@section scripts{
    <script>
        $(document).ready(function () {
            $(".add-to-cart").click(function () {
                var productId = $(this).data("product-id");
                var token = $('input[name="__RequestVerificationToken"]').val(); // Lấy mã thông báo CSRF

                $.ajax({
                    url: "/Cart?handler=AddToCart", // Đảm bảo bạn đang truy cập đúng URL của trang Razor Page
                    data: {
                        productId: productId,
                        quantity: 1,
                        __RequestVerificationToken: token // Truyền mã thông báo CSRF
                    },
                    type: "POST",
                    success: function (data) {
                        toastr.success("Add to Cart Successfully");
                    },
                    error: function () {
                        alert("An error occurred while adding the product to the cart.");
                    }
                });
            });
        });
        $(document).ready(function () {
            // Bắt sự kiện click trên thẻ <a> có class "category-link"
            $(".category-link").click(function () {
                // Lấy giá trị data-category từ thẻ <a>
                var category = $(this).data("category");

                // Chuyển hướng trang Razor Page "Products" với tham số truyền vào
                window.location.href = "/Products?selectedCategory=" + category;
            });
        });
    </script>
}

